# ER模型->关系模型

将 **ER模型** 转换为 **关系模型（即数据库表结构）** 是一个标准化的、有明确规则的过程。这是数据库逻辑设计的核心步骤。

---

## **一、转换的核心规则**

### **规则1：实体 → 关系表**
- 每个实体转换为一个独立的**关系表**。
- 实体的**属性**转换为表的**列（字段）**。
- 实体的**主键（关键属性）** 转换为表的**主键**。

### **规则2：联系 → 关系表或外键**
这是转换的核心，根据**联系的类型**（1:1, 1:N, M:N）和**联系的属性**，处理方式不同。

#### **情况A：多对多联系 → 必须生成新表**
- **规则**：任何 **M:N（多对多）** 联系都必须转换为一个独立的**新表**。
- **方法**：
    1.  新表的名称通常是联系名，或者两个实体名的组合。
    2.  新表的主键由**关联的两个实体的主键**共同组成（联合主键）。
    3.  这两个实体主键同时也作为外键，分别参照到对应的实体表。
    4.  **联系的属性**（如果有）转换为新表的列。

#### **情况B：一对多联系 → 外键并入“多”方**
- **规则**：**1:N** 联系通过在 **“多”方** 的表中添加**外键**来实现，**不创建新表**。
- **方法**：在“多”方的表中，加入“一”方表的**主键**作为外键。
- **联系的属性**（如果有）也一并放入“多”方的表中。

#### **情况C：一对一联系 → 外键并入任意一方**
- **规则**：**1:1** 联系比较灵活，可以在**任意一方**的表中加入另一方的**主键作为外键**。
- **选择策略**：
    - **原则**：将外键放在**查询更频繁**或**非空更自然**的一方。
    - **常用方法**：如果一方是**完全参与**（即该实体每个实例都必须参与联系，如“员工必须有一个工位”），则将外键放在完全参与方更合适。

### **规则3：继承/泛化 → 多种策略**
- **单表继承**：将父类和所有子类的属性合并到一个大表中，用一个“类型”字段区分。
- **类表继承**：父类一个表，每个子类一个独立的表，子类表的主键同时也是外键，参照父类表。
- **具体表继承**：每个子类一个独立的表，包含父类和自己的所有属性（父类表可能不存在）。

---

## **二、完整转换示例**

### **原始ER模型描述**
假设我们有以下实体和联系：
1.  **实体**：
    - `学生`：**学号**（主键），姓名，年龄
    - `课程`：**课程号**（主键），课程名，学分
    - `学院`：**学院编号**（主键），学院名，院长
2.  **联系**：
    - `属于`：`学生` 与 `学院` 之间是 **N:1** 联系（一个学生属于一个学院，一个学院有多个学生）。
    - `选修`：`学生` 与 `课程` 之间是 **M:N** 联系（一个学生选多门课，一门课有多个学生选），该联系有属性“成绩”。

---

### **转换步骤与结果**

#### **步骤1：转换所有实体**
每个实体直接变成一张表。

```sql
-- 学院表 (来自“学院”实体)
CREATE TABLE 学院 (
    学院编号 INT PRIMARY KEY,
    学院名 VARCHAR(50),
    院长 VARCHAR(20)
);

-- 学生表 (来自“学生”实体)
-- 注意：这里先不处理“属于”联系的外键
CREATE TABLE 学生 (
    学号 INT PRIMARY KEY,
    姓名 VARCHAR(20),
    年龄 INT
    -- 所属学院 (外键，下一步处理)
);

-- 课程表 (来自“课程”实体)
CREATE TABLE 课程 (
    课程号 INT PRIMARY KEY,
    课程名 VARCHAR(50),
    学分 DECIMAL(3,1)
);
```

#### **步骤2：转换“属于”联系 (N:1)**
这是一个一对多联系，外键放在“多”方，即`学生`表。

```sql
-- 修改后的学生表
CREATE TABLE 学生 (
    学号 INT PRIMARY KEY,
    姓名 VARCHAR(20),
    年龄 INT,
    所属学院编号 INT, -- 新增外键列
    FOREIGN KEY (所属学院编号) REFERENCES 学院(学院编号)
);
```

#### **步骤3：转换“选修”联系 (M:N)**
这是一个多对多联系，必须**创建新表**。新表的主键是`学生`和`课程`主键的组合，并包含联系属性“成绩”。

```sql
-- 选课表 (来自“选修” M:N 联系)
CREATE TABLE 选课 (
    学号 INT,
    课程号 INT,
    成绩 DECIMAL(5,2), -- 联系的属性
    PRIMARY KEY (学号, 课程号), -- 联合主键
    FOREIGN KEY (学号) REFERENCES 学生(学号),
    FOREIGN KEY (课程号) REFERENCES 课程(课程号)
);
```

---

### **最终生成的关系模式（表结构）**

1.  **学院** (`学院编号`, 学院名，院长)
2.  **学生** (`学号`, 姓名，年龄，`所属学院编号`)  // `所属学院编号` 参照 **学院** 表
3.  **课程** (`课程号`, 课程名，学分)
4.  **选课** (`学号`, `课程号`, 成绩)  // (`学号`, `课程号`) 联合主键，分别参照 **学生** 和 **课程** 表

**关系图示意**：
```
学院 (1) <--- 被属于 --- (N) 学生 (N) <--- 通过选课表 ---> (M) 课程
```

---

## **三、总结与记忆口诀**

1.  **实体变表，属性变列**：最简单直接。
2.  **联系看类型**：
    - **M:N（多对多）** → **必建新表**，**主键是组合**。
    - **1:N（一对多）** → **外键放“多”家**。
    - **1:1（一对一）** → **外键放一家**（选查询多或强制参与的一方）。
3.  **属性跟键走**：联系的属性跟随转换后的外键或新表。

**本质思想**：用**主键**和**外键**的参照关系，在二维表的世界里模拟出实体间的各种复杂联系。

这个过程确保了ER图中定义的概念结构，能够无损地、高效地在关系型数据库中实现。