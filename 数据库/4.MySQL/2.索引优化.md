# 索引优化

## 1. 高级优化技巧：覆盖索引 (Covering Index)

这是解决“回表”性能问题的终极手段。

**概念**：如果一个索引包含（覆盖）了查询语句中需要的所有字段，就不需要再回表查询。

* **场景**：
  有一个索引 `idx_key(name, age)`。
* **查询 A (回表)**：

```sql
SELECT * FROM users WHERE name = 'Alice';
-- 需要回表去拿 email, address 等其他字段。

```


* **查询 B (覆盖 - 极快)**：

```sql
SELECT name, age, id FROM users WHERE name = 'Alice';
-- 需要的字段（name, age）都在索引树上，id 也在（二级索引存主键），直接返回，无需回表。

```


**优化建议**：对于高频查询，尽量设计联合索引来覆盖所需字段。

---

## 2. 索引失效的常见场景

即使建了索引，写得烂的 SQL 也会导致索引失效（全表扫描）：

1. **函数运算**：`WHERE YEAR(create_time) = 2024`（应对字段进行计算）。
2. **隐式类型转换**：`WHERE phone_varchar = 123456`（字符串没加单引号，转数字导致全表扫描）。
3. **模糊查询左通配**：`WHERE name LIKE '%James'`（B+ 树是从左往右排的，左边都不确定，无法查）。
4. **`OR` 条件**：如果 `OR` 两边的字段不全都有索引，引擎往往会放弃索引选择全表扫描。