# 切分

## 水平切分（哈希、范围、映射表）

水平切分（Sharding）是将同一个表中的记录（行），拆分到多个结构相同的表中。

当一个表的数据不断增多时，Sharding 是必然的选择，它可以将数据分布到集群的不同节点上，从而减缓单个数据库的压力。

## Sharding 策略

1. 哈希取模：`hash(key) % N`；
2. 范围： ID 范围、时间范围；
3. 映射表：使用单独的一个数据库，来存储映射关系。

## Sharding 存在问题

1. 事务问题：使用分布式事务来解决；

2. 连接：可以将原来连接分解成多个单表查询，然后在应用程序中进行连接；

3. ID 唯一性：使用全局唯一 ID、或者为每个分片指定一个 ID 范围

## 垂直切分

垂直切分是将一张表**按列切分**成多个表 （左右切分），部署到不同的库，切分原则：

1. 按照列的关系密集程度进行切分；
2. 按照列的使用率进行切分；

例如：将原来的电商数据库垂直切分成商品数据库、用户数据库等。

## 分库和分表

1. 分库：为了解决数据库连接资源不足问题和磁盘IO的性能瓶颈问题。
2. 分表：为了解决单表数据量太大问题，此外还可以解决消耗cpu资源问题。
3. 分库分表：可以解决数据库连接资源不足、磁盘IO的性能瓶颈、检索数据耗时 和 消耗cpu资源等问题。

如果在有些业务场景中，用户并发量很大，但是需要保存的数据量很少，这时可以只分库，不分表。

如果在有些业务场景中，用户并发量不大，但是需要保存的数量很多，这时可以只分表，不分库。

如果在有些业务场景中，用户并发量大，并且需要保存的数量也很多时，可以分库分表。