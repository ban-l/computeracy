# 日期函数

在 MySQL 中，日期和时间处理是非常强大的功能。以下是常用的日期相关函数分类整理：

## 获取当前日期时间
```sql
SELECT NOW();        -- 当前日期时间：2024-01-15 10:30:45
SELECT CURDATE();    -- 当前日期：2024-01-15
SELECT CURTIME();    -- 当前时间：10:30:45
SELECT SYSDATE();    -- 系统日期时间
SELECT CURRENT_DATE(); -- 同 CURDATE()
SELECT CURRENT_TIME(); -- 同 CURTIME()
SELECT CURRENT_TIMESTAMP(); -- 同 NOW()
```

## 提取日期时间部分
```sql
SELECT DATE('2024-01-15 10:30:45');  -- 2024-01-15
SELECT TIME('2024-01-15 10:30:45');  -- 10:30:45
SELECT YEAR('2024-01-15');          -- 2024
SELECT MONTH('2024-01-15');         -- 1
SELECT DAY('2024-01-15');           -- 15
SELECT HOUR('10:30:45');            -- 10
SELECT MINUTE('10:30:45');          -- 30
SELECT SECOND('10:30:45');          -- 45
SELECT MICROSECOND('10:30:45.123456'); -- 123456
SELECT DAYOFWEEK('2024-01-15');     -- 2 (周日=1, 周一=2,...)
SELECT DAYOFMONTH('2024-01-15');    -- 15
SELECT DAYOFYEAR('2024-01-15');     -- 15
SELECT WEEK('2024-01-15');          -- 第几周
SELECT QUARTER('2024-01-15');       -- 1 (季度)
```

## 日期格式化
```sql
SELECT DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s'); -- 2024-01-15 10:30:45
SELECT DATE_FORMAT(NOW(), '%W, %M %d, %Y');    -- Monday, January 15, 2024
SELECT DATE_FORMAT(NOW(), '%Y年%m月%d日');     -- 2024年01月15日
-- 常用格式符：
-- %Y 四位年份，%y 两位年份
-- %m 月份(01-12)，%c 月份(1-12)
-- %d 日期(01-31)，%e 日期(1-31)
-- %H 24小时制，%h 12小时制
-- %i 分钟，%s 秒
-- %W 星期名，%a 星期缩写
-- %M 月份名，%b 月份缩写
```

## 日期计算
```sql
-- 日期加减
SELECT DATE_ADD('2024-01-15', INTERVAL 1 DAY);     -- 加1天
SELECT DATE_SUB('2024-01-15', INTERVAL 1 MONTH);   -- 减1月

-- 快捷方式
SELECT '2024-01-15' + INTERVAL 1 YEAR;  -- 加1年
SELECT '2024-01-15' - INTERVAL 1 WEEK;  -- 减1周

-- 具体计算
SELECT ADDDATE('2024-01-15', 7);        -- 加7天
SELECT SUBDATE('2024-01-15', 7);        -- 减7天

-- 日期差
SELECT DATEDIFF('2024-01-20', '2024-01-15'); -- 5 (天数差)
SELECT TIMEDIFF('10:30:00', '09:15:00');     -- 01:15:00 (时间差)
SELECT TIMESTAMPDIFF(MINUTE, '2024-01-15 09:00:00', '2024-01-15 10:30:00'); -- 90 (分钟差)
```

## 日期验证和转换
```sql
-- 验证日期有效性
SELECT ISDATE('2024-02-30');  -- 0 (无效)
SELECT ISDATE('2024-02-28');  -- 1 (有效)

-- 字符串转日期
SELECT STR_TO_DATE('15-01-2024', '%d-%m-%Y');  -- 2024-01-15
SELECT STR_TO_DATE('2024年01月15日', '%Y年%m月%d日');

-- UNIX时间戳转换
SELECT UNIX_TIMESTAMP();              -- 当前时间戳
SELECT FROM_UNIXTIME(1705283445);     -- 时间戳转日期
SELECT UNIX_TIMESTAMP('2024-01-15 10:30:45');
```

## 其它实用函数
```sql
-- 获取月份最后一天
SELECT LAST_DAY('2024-02-15');  -- 2024-02-29

-- 获取周的开始和结束
SELECT DATE_SUB('2024-01-15', INTERVAL (DAYOFWEEK('2024-01-15')-2) DAY) AS week_start;
SELECT DATE_ADD('2024-01-15', INTERVAL (8-DAYOFWEEK('2024-01-15')) DAY) AS week_end;

-- 提取时间部分
SELECT EXTRACT(YEAR FROM '2024-01-15');     -- 2024
SELECT EXTRACT(YEAR_MONTH FROM '2024-01-15'); -- 202401
SELECT EXTRACT(DAY_HOUR FROM '2024-01-15 10:30:45'); -- 1510

-- 时间合成
SELECT MAKEDATE(2024, 15);     -- 2024年的第15天
SELECT MAKETIME(10, 30, 45);   -- 10:30:45
```

## 实际应用示例
```sql
-- 1. 计算年龄
SELECT name, YEAR(CURDATE()) - YEAR(birthdate) - 
       (DATE_FORMAT(CURDATE(), '%m%d') < DATE_FORMAT(birthdate, '%m%d')) 
       AS age FROM users;

-- 2. 查询最近7天的数据
SELECT * FROM orders 
WHERE order_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY);

-- 3. 按月份分组统计
SELECT DATE_FORMAT(order_date, '%Y-%m') AS month,
       COUNT(*) AS order_count
FROM orders
GROUP BY DATE_FORMAT(order_date, '%Y-%m');

-- 4. 计算工作日（排除周末）
SELECT DATEDIFF('2024-01-20', '2024-01-15') -
       FLOOR((DATEDIFF('2024-01-20', '2024-01-15') + 
       WEEKDAY('2024-01-15') + 1) / 7) * 2 -
       CASE WHEN WEEKDAY('2024-01-20') < WEEKDAY('2024-01-15') THEN 2 ELSE 0 END
       AS workdays;
```

## 使用建议
1. **存储格式**：建议使用 `DATETIME` 或 `TIMESTAMP` 类型存储完整日期时间
2. **时区处理**：使用 `CONVERT_TZ()` 处理多时区数据
3. **索引优化**：对日期字段使用函数会导致索引失效
   ```sql
   -- 避免 ❌
   SELECT * FROM orders WHERE YEAR(order_date) = 2024;
   
   -- 推荐 ✅
   SELECT * FROM orders 
   WHERE order_date >= '2024-01-01' 
     AND order_date < '2025-01-01';
   ```

这些函数能帮你高效处理 MySQL 中的日期时间数据。需要具体哪方面的详细解释吗？